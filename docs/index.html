<!DOCTYPE html>
<html lang="zh-cmn">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Baozier">
		<title>战国史话</title>
		<link rel="stylesheet" type="text/css" href="public/general.css" >
		<link rel="stylesheet" type="text/css" href="vendor/font-awesome/css/font-awesome.min.css" >
    </head>
	<body>
		<script>
			var data;
			try {
				const fs = require('fs');
				const path = require('path');
				var dir = path.join(__dirname, './save/');
				var save = [];
				fs.readdirSync(dir).forEach(function(file) {
					if (file.substr(-5) === ".json") {
						save.push({
							name: file,
							time: new Date(fs.statSync(dir + file).mtime).getTime()
						});
					}
				});
				save.sort(function(a, b) {
					return a.time < b.time;
				});
				var scenerios = path.join(__dirname, './scenario/');
				var scenerio = [], content;
				fs.readdirSync(scenerios).forEach(function(file) {
					content = JSON.parse(fs.readFileSync(scenerios + file, {encoding:'utf-8'}));
					scenerio.push(content);
				});
			} catch(e) {}
			data = {
				"settings": {
					"name": "问鼎中原",
					"desc": "齐楚燕赵韩魏七雄并起",
					"delay": 2000,
					"mode": 1,
					"basic": 0,
					"mist": 1,
					"music": 0,
					"volume": 6
				},
				"round": 0,
				"stage": null,
				//"stage": 2,
				"history": [],
				"player": [0, 1, 1, 1, 1, 1, 1, 1, 0],
				"allies": [
					
				],
				"relations": [
					[],
					[7, 5, 2, 4, 6, 3],
					[3, 5, 4, 6, 1, 7],
					[2, 5, 6, 4, 1, 7],
					[5, 6, 2, 1, 3, 7],
					[6, 4, 3, 2, 1, 7],
					[5, 4, 3, 2, 7, 1],
					[1, 5, 3, 6, 4, 2],
					[]
				],
				"power": [0, 6, 2, 3, 5, 8, 5, 4, 0],
				"hero": [
					[],
					[1, 1, 1, 1, 1, 1], 
					[1, 1, 1, 1, 1, 1], 
					[1, 1, 1, 1, 1, 1],
					[1, 1, 1, 1, 1, 1], 
					[1, 1, 1, 1, 1, 1], 
					[1, 1, 1, 1, 1, 1],
					[1, 1, 1, 1, 1, 1],
					[]
				],
				"fame": [1, 2, 6, 4, 7, 3, 5],
				"force": [2, 7, 6, 4, 5, 1, 3],
				"cities": [
					{"code": 0, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 1, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 2, "occupy": 4, "army": [8, 8], "status": [1, 1], "order": null},
					{"code": 3, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 4, "occupy": 4, "army": [8, 8], "status": [1, 1], "order": null},
					{"code": 5, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 6, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 7, "occupy": 3, "army": [3], "status": [1], "order": null},
					{"code": 8, "occupy": 3, "army": [0], "status": [1], "order": null},
					{"code": 9, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 10, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 11, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 12, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 13, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 14, "occupy": 7, "army": [0, 0], "status": [1, 1], "order": null},
					{"code": 15, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 16, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 17, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 18, "occupy": 5, "army": [0], "status": [1], "order": null},
					{"code": 19, "occupy": 6, "army": [6], "status": [1], "order": null},
					{"code": 20, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 21, "occupy": 1, "army": [1, 8], "status": [1, 1], "order": null},
					{"code": 22, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 23, "occupy": 1, "army": [0], "status": [1], "order": null},
					{"code": 24, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 25, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 26, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 27, "occupy": 6, "army": [0, 0], "status": [1, 1], "order": null},
					{"code": 28, "occupy": 5, "army": [5, 5, 5], "status": [1, 1, 1], "order": null},
					{"code": 29, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 30, "occupy": 8, "army": [0], "status": [1], "order": null},
					{"code": 31, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 32, "occupy": 2, "army": [0], "status": [1], "order": null},
					{"code": 33, "occupy": 2, "army": [2, 0], "status": [1, 1], "order": null},
					{"code": 34, "occupy": 0, "army": [], "status": [], "order": null},
					{"code": 35, "occupy": 2, "army": [0], "status": [1], "order": null}
				]
			}
		</script>
		<div v-cloak id="app" onselectstart="return false;">
			<audio ref="music" loop>
			  <source src="public/sound.mp3" type="audio/mpeg">
			</audio>
			<template v-if="stage !== null">
				<decision-board
					ref="board"
					v-bind:key="round"
					v-bind:stage="stage" 
					v-bind:player="player"
					v-bind:state="statesInfo"
					v-bind:cities="cities"
					v-bind:relations="relations"
					v-bind:rank="rank"
					v-bind:orders="fame"
					v-bind:settings="settings"
					v-bind:focus="focus"
					v-bind:hero="hero"
					v-bind:force="force"
					v-bind:power="power"
					v-bind:situation="situation"
					@addNewAlly="addNewAlly"
					@removeAlly="removeAlly"
					@addNewHistory="addNewHistory"
					@toNextStage="toNextStage"
					@increaseRelation="increaseRelation"
					@decreaseRelation="decreaseRelation"
					@saveItemOrder="saveItemOrder"
					@updateOrderOfCities="updateOrderOfCities"
					@disturbPowerPoint="disturbPowerPoint"
					@replaceCitisOccupy="replaceCitisOccupy"
					@handleEvent="handleEvent"
				></decision-board>
			    <main id="main" class="full">
			    	<template v-for="(c, index) in getCitiesInfo()">
			    		<city-info 
			    			v-bind:definition="c" 
			    		></city-info>
			    		<occupy-info 
			    			v-bind:player="player.indexOf(2)"
			    			v-bind:definition="c" 
			    			v-bind:data="cities[index]"
			    			v-bind:stage="stage"
			    			v-bind:states="statesInfo"
			    			v-bind:state="getStatesInfo()[cities[index].occupy]"
			    			v-bind:mist="settings.mist"
			    			@saveItemOrder="saveItemOrder"
			    			@updateFocusVariable="updateFocusVariable"
			    		></occupy-info>
			    	</template>
			    </main>
			    <div id="map" class="full"></div>
			    <section id="rank">
			    	<div id="rank-fame">
						<fame-info
							v-bind:data="fame"
							v-bind:player="player.indexOf(2)"
							v-bind:type="0"
						></fame-info>
						<fame-info
							v-bind:data="force"
							v-bind:player="player.indexOf(2)"
							v-bind:type="1"
						></fame-info>
						<div id="rank-treasure">
							<treasure-info 
								v-bind:occupy="getStatesInfo()[fame[0]].name" v-bind:type="0">
							</treasure-info>
							<treasure-info 
								v-bind:occupy="getStatesInfo()[force[0]].name" v-bind:type="1">
							</treasure-info>
						</div>
			    	</div>
			    	<supply-info 
			    		v-bind:data="statesInfo"
			    		v-bind:player="player"
			    	></supply-info>
			    </section>
			    <aside id="aside">
			    	<h4>回合: {{round + 1}}</h4>
			    	<h4 v-bind:title="getEventDesc(situation)">{{getEventSituation(situation)}}</h4>
			    	<h4 v-bind:title="'四夷入侵时,各国损失与四夷战力相等的国力.国库亏空时,损失加倍'">
			    		四夷战力: {{wild}}
			    	</h4>
			    	<h5>势力</h5>
			    	<template v-for="(s, index) in getStatesInfo()" v-if="player[index]!==0">
				    	<state-info
				    		v-bind:definition="s"
				    		v-bind:player="player[index]===2"
				    		v-bind:data="statesInfo[index]"
				    		v-bind:power="power"
				    		v-bind:hero="hero[index]"
				    		v-bind:rank="rank"
				    		v-bind:mist="settings.mist"
				    	>
				    	</state-info>
			    	</template>
			    	<h5>史记</h5>
			    	<div id="aside-history">
			    		<section class="history-round" v-for="(h, i) in history">
			    			<header>回合: {{i + 1}}</header>
			    			<div v-for="r in h">{{r}}</div>
			    		</section>
			    	</div>
			    </aside>
			</template>
			<template v-else>
				<section class="start full" style="background-color:darkslategrey">
					<h2><i class="fa fa-shield" aria-hidden="true"></i>战国史话</h2>
					<h3 style="color:lightgrey">剧本</h3>
					<div class="start-theme">
						<h3 style="margin-top:30pt"><b>{{settings.name}}</b></h3>
						<p style="font-size:10pt;letter-spacing:2pt">{{settings.desc}}</p>
					</div>
					<div class="start-setting">
						<h4>游戏速度</h4>
						<select v-model.number="settings.delay" style="margin-top:2pt;width:100pt;padding:2pt 0">
							<option style="padding:2pt 0" value="1000"> 快 </option>
							<option style="padding:2pt 0" value="2000"> 较快 </option>
							<option style="padding:2pt 0" value="3000"> 正常 </option>
							<option style="padding:2pt 0" value="4000"> 较慢 </option>
							<option style="padding:2pt 0" value="5000"> 慢 </option>
						</select>
						<h4 style="margin-top:5pt">游戏模式</h4>
						<select v-model.number="settings.mode" style="margin-top:2pt;width:100pt;padding:2pt 0"
							v-on:change="removeSelect"
						>
							<option style="padding:2pt 0; background-color: transparent" value="0" 
								title="您将观看电脑战斗直至您退出游戏"
							>
								 置身事外 
							</option>
							<option style="padding:2pt 0; background-color: transparent" value="1" 
								title="您将控制一个国家并与电脑在十回合的较量中分出胜负"
							>
								 十回争霸 
							</option>
							<option 
								title="您将一直参照直至您退出游戏, 仅支持困难模式"
								style="padding:2pt 0; background-color: transparent" value="2"
							>
								 灭国称帝 
							</option>
						</select>
						<template v-if="settings.mode!==0">
							<h4 v-if="settings.mode !== 2" style="margin-top:5pt">游戏难度</h4>
							<h4 v-else style="margin-top:5pt">困难模式</h4>
							<select 
								v-show="settings.mode !== 2"
								v-model.number="settings.basic" 
								style="margin-top:2pt;width:100pt;padding:2pt 0"
							>
								<option style="padding:2pt 0" value="0"> 简单 </option>
								<option 
									style="padding:2pt 0;background-color:transparent" value="1"
									title="电脑势力每回合获得一次额外义勇兵事件"
								>
									 困难 
								</option>
							</select>
							<h4 style="margin-top:5pt">战争迷雾</h4>
							<select v-model.number="settings.mist" style="margin-top:2pt;width:100pt;padding:2pt 0">
								<option style="padding:2pt 0" value="1"> 开 </option>
								<option style="padding:2pt 0" value="0"> 关 </option>
							</select>
						</template>
					</div>
					<div class="start-setting">
						<h4>背景音乐</h4>
						<select v-model.number="settings.music" v-on:change="setMusic"
							style="margin-top:2pt;width:100pt;padding:2pt 0"
						>
							<option style="padding:2pt 0" value="0"> 关 </option>
							<option style="padding:2pt 0" value="1"> 开 </option>
						</select>
						<h4 style="margin-top:5pt">音量大小</h4>
						<select v-model.number="settings.volume" v-on:change="setVolume"
							style="margin-top:2pt;width:100pt;padding:2pt 0"
						>
							<option style="padding:2pt 0" value="1"> 1 </option>
							<option style="padding:2pt 0" value="2"> 2 </option>
							<option style="padding:2pt 0" value="3"> 3 </option>
							<option style="padding:2pt 0" value="4"> 4 </option>
							<option style="padding:2pt 0" value="5"> 5 </option>
							<option style="padding:2pt 0" value="6"> 6 </option>
							<option style="padding:2pt 0" value="7"> 7 </option>
							<option style="padding:2pt 0" value="8"> 8 </option>
							<option style="padding:2pt 0" value="9"> 9 </option>
							<option style="padding:2pt 0" value="10"> 10 </option>
						</select>
					</div>
					<div v-if="save !== null && save !== undefined" class="start-setting" 
						style="margin-left: 80pt; border-left: 2pt solid darkgrey; padding: 0 25pt; height:180pt; overflow-y: scroll"
					>
						<h4 style="margin-bottom: 5pt">读取存档</h4>
						<div v-for="(s, i) in save" 
							style="margin-bottom: 5pt; font-size: 11pt; cursor: pointer; color: darkgrey"
							v-on:click="loadSave(i)"
						>
							{{s.name.slice(0, -5)}}
						</div>
					</div>
					<div v-if="scenerio !== null && scenerio !== undefined">
						<h3 style="display: block; color: lightgrey; margin-bottom: 5pt">
							更换剧本
						</h3>
						<div v-for="(s, i) in scenerio" 
							style="
								background-color: darkgrey; display: inline-block; 
								vertical-align: middle; margin-right: 10pt; padding: 10pt 5pt; 
								border-radius: 3pt; cursor: pointer
							"
							v-bind:title="s.settings.desc"
							v-on:click="selectScenerio(i)"
						>
							{{s.settings.name}}
						</div>
					</div>
					<div style="display:block;margin-top:15pt">
						<h3 style="display:inline-block;vertical-align:middle;color:lightgrey"
							v-if="player.indexOf(2) === -1 && settings.mode !== 0"
						>
							选择国家
						</h3>
						<input 
							style="display:inline-block;vertical-align:middle;margin-left:5pt;width:100pt" 
							type="button" value="开始游戏" v-on:click="startGame" v-else
						/>
					</div>
					<div style="display:block;width:850pt">
						<div class="start-state" v-for="(state, i) in getStatesInfo()" 
							v-if="player[i] !== 0" v-on:click="selectState(i)"
							v-bind:style="{backgroundColor:player[i]===2?'white':'darkgrey'}"
						>
							<div class="start-state-name"
								v-bind:style="{backgroundColor: state.color}"
							>
								<h4>{{state.name}}</h4>
							</div>
							<span>{{getHerosInfo()[i][getHeroLeaderIndex()[i]].name}}</span>
							<h4 style="display:block;margin-top:5pt">都城 {{getCitiesInfo()[getStatesBaseLevel()[i][3]].name}}</h4>
							<div class="start-state-army">
								<p>
									{{getArmyInfo()[i].name}} - 攻击{{getArmyInfo()[i].attack}} 防御{{getArmyInfo()[i].defend}}
								</p>
							</div>
							<p style="display:block;font-size:10pt">
								{{getStatesInfo()[i].motto}}
							</p>
						</div>
					</div>
				</section>
			</template>
		</div>
		<script type="text/javascript" src="vendor/vue.js"></script>
		<script type="text/javascript" src="source/definition/state.js"></script>
		<script type="text/javascript" src="source/definition/city.js"></script>
		<script type="text/javascript" src="source/definition/army.js"></script>
		<script type="text/javascript" src="source/definition/stage.js"></script>
		<script type="text/javascript" src="source/definition/hero.js"></script>
		<script type="text/javascript" src="source/definition/skill.js"></script>
		<script type="text/javascript" src="source/definition/order.js"></script>
		<script type="text/javascript" src="source/definition/event.js"></script>
		<script type="text/javascript" src="source/component/city-info.js"></script>
		<script type="text/javascript" src="source/component/occupy-info.js"></script>
		<script type="text/javascript" src="source/component/state-info.js"></script>
		<script type="text/javascript" src="source/component/fame-info.js"></script>
		<script type="text/javascript" src="source/component/supply-info.js"></script>
		<script type="text/javascript" src="source/component/treasure-info.js"></script>
		<script type="text/javascript" src="source/ai/ally.js"></script>
		<script type="text/javascript" src="source/ai/breach.js"></script>
		<script type="text/javascript" src="source/ai/plan.js"></script>
		<script type="text/javascript" src="source/ai/disturb.js"></script>
		<script type="text/javascript" src="source/ai/hero.js"></script>
		<script type="text/javascript" src="source/ai/retreat.js"></script>
		<script type="text/javascript" src="source/ai/attack.js"></script>
		<script type="text/javascript" src="source/ai/recruit.js"></script>
		<script type="text/javascript" src="source/processor/before-battle.js"></script>
		<script type="text/javascript" src="source/processor/after-battle.js"></script>
		<script type="text/javascript" src="source/component/decision-board.js"></script>
		<script type="text/javascript" src="source/epic.js"></script>
	</body>
</html>